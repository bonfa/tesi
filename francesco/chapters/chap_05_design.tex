\chapter{Design}
	For reasons of clarity, the description of the design of the software follows a top-down approach. The first section gives an overview of the software and the others study in deep specific aspects of it.

	To better explain the contents and the structure of the design, the description is supported by \mbox{UML} diagrams. As the following sections describe the software at different levels of detail, the diagrams reflect this approach. In the first section, for example, the diagram is used only to present the classes in the overall structure. For this reason it contains only the names of the classes. Further details are added in the diagrams in the next sections, according with the top-down approach of the chapter.
\begin{comment}
	Moreover, as the software has been developed in team but this document focuses only on a subset of the whole work, some classes are shown in the diagrams but are not described. The team developed them in order to accomplish tasks fundamental in the whole context of the software but not of interest in this particular work. Such classes can not be removed from the diagrams because they influence the design.
\end{comment}
	\section{Overview of the design}
	The software is composed of four main parts, one for processing images and videos, one for containing the hierarchy of the objects recognized during such processing, one for allowing ACT-R to communicate with the software and one containing all the utility functions used by all the other parts.

	\begin{figure}[h]
	  \begin{center} 
	    \fbox{	
	       \includegraphics[scale=0.55]{images/ch_05/progettazione_overview2.png}
	    }
	  \end{center} 
	  \caption{\textit{Class diagram illustrating a high level overview of the design of the software }}  
	  \label{fig:swArchitecture}
 	\end{figure}		

	Image \ref{fig:swArchitecture} shows a class diagram which describes two of the parts that compose the software. 
	The part dedicated to the processing of images and video is located on the left and is composed by the classes \emph{Proxy}, \emph{FeatureGetter}, \emph{FeatureExtractor}, \emph{Input}, \emph{MarkerDetector} and \emph{QRScanner}.
	The object hierarchy, which is shown on the right, contains the classes \emph{Object}, \emph{BoundingBox}, \emph{Blob}, \emph{QRObject}, \emph{Circle}, \emph{Triangle}, \emph{Quadrilateral}, \emph{Button} and \emph{Marker}.

	

	The other two parts are not included in the design diagrams for different reasons. 
	According with the non-functional requirements, the team planned to try different solutions in order to implement the communication between the software and ACT-R. As different approaches can lead to different architectures, this part has not been designed a priori.
	Regarding the utility part, as it depends strongly by the implementations choices, it is very instable and volatile. Moreover, it is heavily influenced by the chosen communication technique, which, as just described, has not been planned.
	For these reasons, according to the agile development the team decided not to spend time in planning a fixed structure for it.
	
	
	\section{Feature Extraction Classes}\label{featExtraction}	
	The classes that play the role of extracting features from the images are \emph{Proxy}, \emph{FeatureGetter} and \emph{FeatureExtractor}. \emph{Input} has the role of intermediation between this part of the software and the one which manages the communication with \mbox{ACT-R}.

\begin{comment}
	\emph{MarkerDetector} and \emph{QRScanner} classes have been developed by the team in order to make the software locate markers and finding and decoding QR object. These tasks, although are fundamental in the whole work, are not significant in the objective of this particular work, so they are not described.
\end{comment}
	\begin{figure}[h]
	  \begin{center} 
	    \fbox{	
	       \includegraphics[scale=0.65]{images/ch_05/feature.png}
	    }
	  \end{center} 
	  \caption{\textit{Class diagram illustrating the part that extracts the feature of the images}}  
	  \label{fig:FeatureDesign}
 	\end{figure}
	
	Figure \ref{fig:FeatureDesign} contains the class diagram that designs the interface of these classes.
	\emph{FeatureExtractor} represents the core of this part. It receives in input an image and processes it in order to extract the features that contains. For each extracted feature it creates a correspondent element in the \emph{object hierarchy}. Such hierarchy is described in section \ref{classHierarchy}. Finally the class creates a list of all such objects and delivers it to FeatureGetter. 

	\emph{Input} is responsible for loading images from files or video streams from the web-cam, if present, and delivering them to FeatureGetter. 

	\emph{FeatureGetter} represents a level of abstraction that avoids to call directly the functions provided by FeatureExtractor and Input, providing a simpler interface. Its functions create the Input object, receive from it the input data, delivers it to FeatureExtractor for the extraction of the feature and deliver the received object list to Proxy.

	\emph{Proxy} has been thought to be another level of abstraction between FeatureGetter and the part of the software which manages the communication with ACT-R. As all the analyzed a-priori procedures for the communication with the artificial intelligence framework need to use specific data types. This class has the main function to transform each object of the object list in the type necessary for the communication to ACT-R.

	The classes \emph{MarkerDetector} and \emph{QRScanner} do not accomplish to the communication with ACT-R nor the extraction of features in the way it is defined in the requirements section of chapter \ref{chObjective}. Their presence makes sense in the context of the whole software, described in \ref{futureDev}. Both of these classes work on video streams: MarkerDetector data looks for \emph{markers}, images with pre-determined patterns, and QRScanner searches for \mbox{QR} elements and tries to decode them. Both marker and \mbox{QR} elements are considered features. This fact explains the presence of these two classes in the feature extraction process. It has been decided not to remove them from the diagrams because they influence the design of the software and represent the motivations to particular design and implementation choices.
 		

\begin{comment}
In this way it represents the only way in which the both It provides functions to load images, extract features from them and return a list of \emph{Object}, each of which represents one of the detected feature. 
The objects are elements of the object hierarchy, that is described in \ref{classHierarchy}. The class also allows to load a video from a webcam, extract a frame from it and apply the same algorithms to it in order to apply the feature extractions feature.
\end{comment}

	
	\section{Class Hierarchy}\label{classHierarchy}
	The class hierarchy contains all the features that are recognized during the processing of the image. Each feature has a correspondent object that describes it. 
	The figure \ref{fig:HierarchyDesign} contains a class diagrams that specifies the hierarchy. 
	\emph{Object} class is the superclass that represents all the possible features, in this case objects, recognized in an image during the feature extraction process. The class has two attributes: a \emph{rotation} and a \emph{bounding box}, which is a shape that encloses the object. This latter element is described by \emph{BoundingBox} class. As specified in the diagram, the bounding box can be only of rectangular shape, in fact its attributes are the coordinate of a point and the horizontal and vertical dimensions.

	\begin{figure}[h]
	  \begin{center} 
	    \fbox{	
	       \includegraphics[scale=0.65]{images/ch_05/hierarchy.png}
	    }
	  \end{center} 
	  \caption{\textit{Class diagram illustrating the class hierarchy of the objects}}  
	  \label{fig:HierarchyDesign}
 	\end{figure}

	The Object type can be specified by two sub-types, \emph{Blob}, that represents a generic shape, and \emph{QR}, representing a \mbox{QR} element. As it is considered useless keeping track of the area of the \mbox{QR} element, only the class Blob has been provided of such attribute. The attribute \emph{content} of \mbox{QR}, instead, represents the information encoded in such element. 

	The class \emph{Blob} is extended by the classes \emph{Circle},\emph{Triangle} and \emph{Quadrilateral}. These elements represent the simple shapes that can be recognized during the recognition process. Each item is defined starting by basic geometrical elements: the circle by center and radius, the triangle by three points, the quadrilateral by four points. The point, in particular, has its corresponding class \emph{Point}. 

	The class \emph{Button} specifies Quadrilateral by adding the attribute \emph{text}, which specifies the message of such button. The fact that such class derives Quadrilateral instead of Blob reflects the requirement that the buttons can be only rectangular. 
	
	The class \emph{Marker} represents a marker, whose concept has been introduced at the end of section \ref{featExtraction}. As described there, the marker and the \mbox{qr} object are extra features. In particular, as they influence the architecture of the software they are only mentioned here. The reader will not find further descriptions about them.

		


\begin{comment} 
	
	
	\section{Communication with ACT-R}

  
  \section{The Whole Software}
  The aim of the 
  \begin{figure}[h]
	  \begin{center} 
		%TODO: aggiungere immagine	
	    %\includegraphics[scale=0.1]{images/ch_04/classDesign.jpg}
	  \end{center} 
	  \caption{\textit{Class diagram of the whole software }}  
	  \label{fig:swArchitecture}
  \end{figure}
  \todo{cambiare l immagine e aggiungere la descrizione...}.

  
  \section{The Class Hierarchy}
  \begin{figure}[h]
	  \begin{center} 
		%TODO: aggiungere immagine
	    %\includegraphics[scale=0.2]{images/ch_04/designClassObjectHierarchy.jpeg}
	  \end{center} 
	  \caption{\textit{Class hierarchy of the recognized objects}}  
	  \label{fig:callHierarchy}
  \end{figure}
   {\newpage}
   {\newpage}
   {\newpage}
   {\newpage}
  The picture above describes the hierarchy of the classes defined to contain the objects detected in the images. The \textit{Object} class represents a generic object that can be found in an image. Thus, everything which is different from the background can be seen as an instance of the \textit{Object} class. Every object must be bounded by a \textit{bounding box}. This structure is represented by the \textit{BoundingBox} class. All the bounding boxes have rectangular shape. The requirements were such that it was not necessary to define more complicate shapes \todo{migliorare questa frase, fa schifo}. The \textit{attended} attribute of the \textit{Object}  class is set to \textit{true} if the object has been already returned to ACT-R, otherwise it is set to \textit{false}. The \textit{rotation} is a value that gives the amount of the rotation in the counterclockwise directions starting from the horizontal direction \todo{controllare la correttezza}. \todo{vedere se il metodo getChunk esiste ancora}\todo{se 
non esiste eliminarlo 
dall immagine}.
  Besides the generic objects, there are two categories of object that can be found in the processed images, the \textit{QR codes} and the \textit{simples shapes}. A simple shape can be, for example, a circle, a square, a rectangle or a triangle. The QR codes is represented in the hierarchy with the \textit{QRObject} class, the generic shape with the \textit{Blob} class.
  This class has the \textit{area} parameter, which stands for the area of the object in pixel, and the  \textit{getArea} method, which returns this value. The \textit{Blob} class is realized by three classes, \textit{Circle}, \textit{Triangle} and \textit{Quadrilateral}. 
  The first one has, as parameters, the \textit{center} and the \textit{radius} of the circle itself.
  The parameters of the \textit{Triangle} and the \textit{Quadrilateral} classes are respectively three and four points, which represent the vertices of the shape. Notice that the \textit{Quadrilateral} class defines every polygon with four sides and four vertices. Thus, rectangles and squares can be instances of this class. 
  The \textit{Button} class is a realization of the \textit{Quadrilateral} class. This is because, as a requirement, buttons have always rectangular or squared shapes. The additional information they add is the \textit{text}, that is a simple message that is always present in a button. It is represented by the \textit{text} attribute. 
  The \textit{Point} class identifies a generic point in the bidimensional space. Its parameters, \textit{x} and \textit{y}, are the two coordinates in the plane.
 
  \todo{... aggiungere, correggere o finire}

  
 \end{comment} 
  
  
  
