\chapter{Implementation And Testing}\label{impl_test}
	
	\section{Implementation}
	
		\subsection{N-sides Shape Detection Algorithm}
		The algorithm used in order to detect n-sides shapes in the images is based on a procedure of corner detection. 
		In order to capture all such objects, the procedure is executed three times for each color level of the image, every time with different parameters.
		As the corner detection algorithm identifies \emph{false corners}, it requires functions for detecting and removing them. 
		In addition, the repetition of the procedure leads to the detection of many sets which describe the same shape.	
		Consequently the algorithm requires procedures that remove the different copies of the same object.


		
		Listing \todo{} contains the pseudo code of the algorithm.
		The first operation is a technique for reducing the noise in the image, followed by the corner detection procedure.
		The latter is applied with three different thresholds for each level of the colored image, red, green and blue.
		This guarantees that all the shapes in the image are recognized.
		
		\begin{lstlisting}

		constant thresholds[3];	

		function detect_polygon(image, sides_number){

			noise_reduction(image);
			
			image_levels[3] = split_in_level(image);
			
			corners = [];
		
			for each level of image_levels do{
				
				for each threshold of thresholds do{

					detected_corners = corner_detection(level,threshold);

					corners.add(detected_corners);
				}
			}	

			
			for each corner_set of corners do{
				if (corner_set.size() < sides_number)
					corners.remove(corner_set);
			}			

			for each corner_set of corners do{
				remove_in_line_points(corner_set);
			}

			for each corner_set of corners do{
				if (corner_set.size() != sides_number)
					corners.remove(corner_set);
			}	
			
		}
		\end{lstlisting}
	

		After the corner detection procedure, an operation of selection is applied, based on the number of detected vertexes.
		In order to recognize a n-sides shape, the sets containing more than n-1 vertexes are kept, the other are discarded.
		For the recognition of quadrilaterals, for example, all the sets with less than 4 elements are discarded.
		


		The fact that not only the sets with n sides are included in the list is a consequence of the corner detection algorithm. 
		It often happens, in fact, that, due to noise in the image or imperfection of the corner detection procedure, a single segment is detected as a set of two or more shorter segments. 
		Each couple of such elements defines a \emph{false corner}. 
		For this reason, even a set of points containing more than n points can define a n-vertex shapes. 
		


		In order to delete the false corners, an algorithm analyzes every point set and calculates the slopes of the straight lines obtained by each couple of adjacent vertexes. 
		If the slopes of two consecutive segments are very close one to each other, the vertex common to both the segments is a false corner and is removed.
		

		
		After this, another selection based on the number of vertexes is applied. This time all the sets not containing n vertexes are discarded.
		
		
		
		Another problem of the algorithm is that, due to different thresholds applied to different levels of the image, a shape is often defined by more sets of points.
		In particular, two points representing the same vertex of the same shape belonging to two different sets, do not have the same coordinates.
		The gap in some cases can be even greater than 15 pixels. 
		For example, the same triangle can be specified by {(0;0),(200;0),(100;200)} and {(2;2),(199;0),(101;197)}. 
		
		

		In order to detect and remove these copies, a function has been introduced that checks all the possible couples of sets. 
		It controls the similarity of two elements by analyzing the positions of the pixels and making comparison about the areas and the perimeter of both the shapes. 
		When two sets specify the same object, the second one is discarded. 
		
		Once removed the copies, the algorithm returns a list containing the remaining sets of points.

		
	

	

	\section{Testing}

